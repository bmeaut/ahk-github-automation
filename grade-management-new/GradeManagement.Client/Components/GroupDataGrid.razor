@using GradeManagement.Client.Pages
@using GradeManagement.Shared.Dtos.Request
@inject HttpClient Http
@inject CrudSnackbarService SnackbarService

<MudDataGrid T="Group" Items="Values" EditMode="DataGridEditMode.Form" ReadOnly="false" CommittedItemChanges="@CommittedItemChanges" Style="width: 100%">
    <Columns>
        <PropertyColumn Property="x => x.Id" Title="Id" IsEditable="false"/>
        <PropertyColumn Property="x => x.Name" Title="Name"/>
        <DataGridActions TItem="Group" OnEditItem="@StartEditing" OnDeleteItem="@DeleteItem"/>
    </Columns>
</MudDataGrid>


@code {
    [Parameter] public List<Group> Values { get; set; }

    string BaseUrl = Endpoints.GROUPS;

    private async Task StartEditing(CellContext<Group?> context)
    {
        await context.Actions.StartEditingItemAsync();
        StateHasChanged();
    }

    private async Task CommittedItemChanges(Group items)
    {
        var response = await Http.PutAsJsonAsync($"{BaseUrl}/{items.Id}", items);
        if (!response.IsSuccessStatusCode)
        {
            await Console.Error.WriteLineAsync("Error");
            SnackbarService.ShowEditError();
        }
        else
        {
            SnackbarService.ShowEditSuccess();
        }
    }

    private async Task DeleteItem(Group item)
    {
        Values.Remove(item);
        var response = await Http.DeleteAsync($"{BaseUrl}/{item.Id}");
        if (!response.IsSuccessStatusCode)
        {
            await Console.Error.WriteLineAsync("Error");
            SnackbarService.ShowDeleteError();
        }
        else
        {
            SnackbarService.ShowDeleteSuccess();
        }

        StateHasChanged();
    }

}
