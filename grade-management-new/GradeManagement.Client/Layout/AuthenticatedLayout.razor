@inherits LayoutComponentBase
@inject SubjectService SubjectService

<MudThemeProvider/>
<MudDialogProvider/>
<MudSnackbarProvider/>

<MudLayout>
    <AuthorizeView>
        <Authorized>
            <ErrorBoundary @ref="errorBoundary">
                <ChildContent>
                    <AppBar DrawerOpened="@_drawerOpen" DrawerToggle="@DrawerToggle"/>
                    <MudDrawer @bind-Open="@_drawerOpen" ClipMode="DrawerClipMode.Docked">
                        <NavMenu/>
                    </MudDrawer>
                    <MudMainContent>
                        <MudContainer MaxWidth="MaxWidth.ExtraExtraLarge">
                            @Body
                        </MudContainer>
                    </MudMainContent>
                </ChildContent>
                <ErrorContent Context="exception">
                    <ErrorComponent Exception="@exception" ErrorBoundary="@errorBoundary"/>
                </ErrorContent>
            </ErrorBoundary>
        </Authorized>
        <NotAuthorized>
            <RedirectToLogin/>
        </NotAuthorized>
    </AuthorizeView>
</MudLayout>

@code {
    private bool _drawerOpen = false;
    private ErrorBoundary? errorBoundary;

    private void DrawerToggle()
    {
        _drawerOpen = !_drawerOpen;
        StateHasChanged();
    }

    protected override async Task OnInitializedAsync()
    {
        await SubjectService.LoadSubjects();
    }

}
